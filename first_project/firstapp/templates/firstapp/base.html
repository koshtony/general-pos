{% load static %}
<!DOCTYPE html>
<html class="dark">
 <head>
  {% load static %}
{% load pwa %}
{% progressive_web_app_meta %}
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <script src="https://cdn.plot.ly/plotly-2.24.1.min.js" charset="utf-8"></script>

 </head>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <title>POS</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="{% static 'firstapp/plugins/fontawesome-free/css/all.min.css' %}">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Tempusdominus Bbootstrap 4 -->
  <link rel="stylesheet" href="{% static 'firstapp/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css' %}">
  <!-- iCheck -->
  <link rel="stylesheet" href="{% static 'firstapp/plugins/icheck-bootstrap/icheck-bootstrap.min.css' %}">
  <!-- JQVMap -->
  <link rel="stylesheet" href="{% static 'firstapp/plugins/jqvmap/jqvmap.min.css' %}">
  <!-- Theme style -->
  <link rel="stylesheet" href="{% static 'firstapp/dist/css/adminlte.min.css' %}">
  <link rel="stylesheet" href="{% static 'firstapp/dist/css/custom_style.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-toaster/4.0.1/css/bootstrap-toaster.min.css">

  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="{% static 'firstapp/plugins/overlayScrollbars/css/OverlayScrollbars.min.css' %}">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="{% static 'firstapp/plugins/daterangepicker/daterangepicker.css' %}">
  <!-- summernote -->
  <link rel="stylesheet" href="{% static 'firstapp/plugins/summernote/summernote-bs4.css' %}">
  <!-- Google Font: Source Sans Pro -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
  
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.5/css/dataTables.bootstrap4.min.css"></script>
  


<script type="text/javascript" src="{% static 'js/idb.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/idbop.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/htmx.min.js' %}"></script>
<style>

  .htmx-indicator{
    opacity:100;
    transition: opacity 500ms ease-in;
}
.htmx-request .htmx-indicator{
    opacity:1
}
.htmx-request.htmx-indicator{
    opacity:1
}

</style>


<body class="hold-transition sidebar-mini layout-fixed" style="zoom:75%">

  <div class="wrapper" >
    
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light" id="uphead">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
        </li>
      </ul>
      &nbsp; &nbsp;
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="btn btn-primary" href="{% url 'firstapp-addstocks' %}" role="button"><i class="fas fa-plus">products</i></a>
        </li>
        &nbsp; &nbsp;
        
        <li class="nav-item">
          <a class="btn btn-primary" href="{% url 'firstapp-addshops' %}" role="button"><i class="fas fa-plus">shops</i></a>
        </li>
    
        &nbsp; &nbsp;
      <li class="nav-item">
        <a  class="btn btn-primary" href="{% url 'firstapp-shops' %}" role="button"><i class="fas fa-list">shops</i></a>
        
        </li>
        &nbsp; &nbsp;
      <li class="nav-item">
        <a class="btn btn-primary" href="{% url 'firstapp-counter' %}" role="button"><i class="fas fa-table">Counter</i></a>
      </li>
      &nbsp; &nbsp;
     <div class="dropdown">
        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown"><i class="fa fa-desktop">Manage</i>
        <span class="caret"></span></button>
        <ul class="dropdown-menu">
          <li><a style="margin-left:30px" type="button" href="{% url 'firstapp-finance' %}"><i class="fa fa-money-bill"> Add Expenses</i></a></li>
          <li><a style="margin-left:30px" type="button" href="{% url 'firstapp-taskslist' %}"><i class="fa fa-file"> Tasks</i></a></li>
           <li><a style="margin-left:30px" type="button" href="{% url 'firstapp-locationlist' %}"><i class="fa fa-clock"> Attendance </i></a></li>
           <li><a style="margin-left:30px" type="button" href="{% url 'firstapp-debtlist' %}"><i class="fa fa-clock"> Debts </i></a></li>
          
        </ul>
      </div>
      &nbsp; &nbsp;
      <li class="nav-item">
        <a class="btn btn-primary" href="" role="button"><i class="fas fa-bell">notifications</i></a>
      </li>
       &nbsp; &nbsp;
       <!--
       <div class="dropdown">
        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown"><i class="fa fa-phone">Contacts</i>
        <span class="caret"></span></button>
        <ul class="dropdown-menu">
          <li><a style="margin-left:30px" type="button" data-toggle="modal" data-target="#contactModal"><i class="fa fa-money-bill"> Add Contacts</i></a></li>
          <li><a style="margin-left:30px" type="button" data-toggle="modal" data-target="#contactListModal"><i class="fa fa-file"> List Contacts</i></a></li>
           <li><a style="margin-left:30px" type="button" data-toggle="modal" data-target="#smsModal"><i class="fa fa-comment"> Bulk Sms </i></a></li>
          
          
        </ul>
      </div>
    -->
   
      &nbsp; &nbsp;
      <div class="dropdown">
        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown"><i class="fa fa-wrench">generator</i>
        <span class="caret"></span></button>
        <ul class="dropdown-menu">
          <li><a style="margin-left:30px" href="{% url 'firstapp-invoice' %}"><i class="fa fa-file-invoice"> invoice </i></a></li>
          <li><a style="margin-left:30px" href="#"><i class="fa fa-money-check">PO</i></a></li>
          
        </ul>
      </div>
    </ul>
    
     
        <a style="margin-left:150px" class="nav-link" href="{% url 'firstapp-addshops' %}" role="button"><i class="fas fa-shopping-cart">{{ request.session.sales | length }}</i></a>
      
      
      <!-- Right navbar links -->
      <!-- <ul class="navbar-nav ml-auto">
        
      </ul> -->
    </nav>
    <!-- /.navbar -->
    
    <!-- Main Sidebar Container -->
   <aside class="main-sidebar sidebar-dark-primary elevation-4">
      <!-- Brand Logo -->
     
      
      <!-- Sidebar -->
      <div class="sidebar">
      
        <!-- Sidebar user panel (optional) -->
        <div class="user-panel mt-3 pb-3 mb-3 d-flex">
          {% if user.is_superuser %}
          <div class="image">
            <img src="{{user.profile.image.url}}" class="img-circle elevation-2" alt="User Image">
          </div>
         
          <div class="info">
            <a href="/admin" class="d-block">Admin</a>
          </div>
         {% endif %}
        </div>
        
        <!-- Sidebar Menu -->
        <nav class="mt-2" hx-boost="true">
          <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          {% if user.is_authenticated %}
          <li class="nav-item">
            <a href="{% url 'firstapp-home' %}" hx-indicator="#newPageSpinner" class="nav-link">
              <i class="nav-icon fas fa-tachometer-alt"></i>
              <p>
             dashboard
              </p>
            </a>
          </li>
          <li class="nav-item">
            <a hx-get="{% url 'simple-counter' %}" hx-target="#linkResp" hx-indicator="#counterSpin"  class="nav-link">
              <i class="nav-icon fa fa-shopping-basket" aria-hidden="true"></i>
              
              <p>
                 simple counter

              </p>
              <i class="fa fa-spinner htmx-indicator" id="counterSpin" ></i>
            </a>
            
          </li>
          <!--
          <li class="nav-item">
            <a href="{% url 'firstapp-counter' %}" class="nav-link">
              <i class="nav-icon fa fa-shopping-basket" aria-hidden="true"></i>
              <p>
                 counter
              </p>
            </a>
          </li>
        -->
          <li class="nav-item">
            <a href="{% url 'firstapp-stocks' %}" class="nav-link" hx-indicator="#newPageSpinner">
              <i class="nav-icon fa fa-cubes" aria-hidden="true"></i>
              <p>
                 Stocks
              </p>
            </a>
          </li>
          <li class="nav-item">
            <a href="{% url 'firstapp-sales' %}" class="nav-link" hx-indicator="#newPageSpinner">
              <i class="nav-icon fa fa-ship" aria-hidden="true"></i>
              <p>
              Sales
              </p>
            </a>
          </li>
           <li class="nav-item">
            <a href="{% url 'firstapp-cashier' %}" class="nav-link" hx-indicator="#newPageSpinner">
              <i class="nav-icon fa fa-credit-card" aria-hidden="true"></i>
              <p>
              Cashier
              </p>
            </a>
          </li>
          <li class="nav-item">
            <a href="{% url 'firstapp-orders' %}" class="nav-link" hx-indicator="#newPageSpinner">
              <i class="nav-icon fa fa-rocket" aria-hidden="true"></i>
              <p>
              Ecommerce
              </p>
            </a>
          </li>
          
          <li class="nav-item">
            <a href="{% url 'firstapp-financesummary' %}" class="nav-link" hx-indicator="#newPageSpinner">
              <i class="nav-icon fas fa-table"></i>
              <p>reports</p>
            </a>
          </li>
          <li class="nav-item">
            <a href="{% url 'firstapp-charts' %}" class="nav-link" hx-indicator="#newPageSpinner">
              <i class="nav-icon fa fa-eye" aria-hidden="true"></i>
              <p>
                 Visuals
              </p>
            </a>
          </li> 

          <li class="nav-item">
            <a href="{% url 'posUsers-profile' %}" class="nav-link" hx-indicator="#newPageSpinner">
              <i class="nav-icon fa fa-user" aria-hidden="true"></i>
              <p>
                User Profile
              </p>
            </a>
          </li> 

          <li class="nav-item">
            <a href="{% url 'logout' %}" class="nav-link" hx-indicator="#newPageSpinner">
              <i class="nav-icon fa fa-user-times" aria-hidden="true"></i>
              <p>
                 logout
              </p>
            </a>
          </li>
          
          
          <li class="line"></li>
          <li class="nav-item">
            <a href="#" class="nav-link">
              <i class="nav-icon fa fa-mobile" aria-hidden="true" hx-indicator="#newPageSpinner"></i>
              <p>
                  Phone Sales
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
             
              <li class="nav-item">
                <a href="{% url 'smart-stocks-upload' %}" class="nav-link" hx-indicator="#newPageSpinner">
                  <i class="nav-icon fa fa-user-circle" aria-hidden="true"></i>
                  <p>Stocks Upload</p>
                </a>
              </li>
             
            </ul>
          </li>
          
          
        
       
        </ul>
        {% else %}
          <li class="nav-item">
            <a href="{% url 'login' %}" class="nav-link">
              <i class="nav-icon fa fa-user" aria-hidden="true"></i>
              <p>
                 login
              </p>
            </a>
          </li>
          {% endif %}
          </nav>
          <!-- /.sidebar-menu -->
        </div>
        <!-- /.sidebar -->
    </aside>

    <!-- add contacts modals -->

    <div class="modal fade" id="contactModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">add contacts</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">

          </div>
          </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" onclick="addContacts()">Save changes</button>
          </div>
        </div>
      </div>
    </div>

    <!--end contacts modal-->

    <!--  list contacts modal-->


    <div class="modal fade" id="contactListModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Contacts List</h4>
          </div>
          <div class="modal-body">
            <table id="example" class="table table-striped table-bordered" style="width:100%">
              <thead>
                  <tr>
                      <th>#</th>
                      <th>Name</th>
                      <th>Phone</th>
                      <th>Created</th>
                      
                  </tr>
              </thead>
              <tbody id="contacts">
              </tbody>
            </table>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
    
    </div>

    <!-- end list contacts modal-->

    <!-- send bulky sms modal-->

    <div class="modal fade" id="smsModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">send bulky sms </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            <div id="plagSpinner" style="display:none; margin-left:50px"> 
              <div class="spinner-grow text-primary" role="status">
                <span class="sr-only">Loading...</span>
              </div>
              <div class="spinner-grow text-secondary" role="status">
                <span class="sr-only">Loading...</span>
              </div>
              <div class="spinner-grow text-success" role="status">
                <span class="sr-only">Loading...</span>
              </div>
            </div>
          </div>
          <div class="modal-body">

            <textarea cols="40" rows="5" id="sms_text"></textarea>
              
           
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-success" onclick="sendSms()"><i class="fa fa-plane"></i></button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
             
          </div>
        </div>
      </div>
    </div>


    <!-- end bulky sms modal-->
       
  <div class="toast" style="position: absolute; top: 50px; right: 0;">
    <div class="toast-header">
      <img src="..." class="rounded mr-2" alt="...">
      <strong class="mr-auto">sys notification</strong>
      <small>0 mins ago</small>
      <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="toast-body">
  
      
    </div>
  </div>
      <!-- Content Wrapper. Contains page content -->
      <div class="content-wrapper" id="mainCont">

        <!-- Content Header (Page header) -->
        <div class="content-header">
           
        </div>

      
        <!-- /.content-header -->
         <section class="content" id="linkResp">
          <div id="newPageSpinner" class="htmx-indicator">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <div class="spinner-border text-secondary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <div class="spinner-border text-success" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <div class="spinner-border text-danger" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <div class="spinner-border text-warning" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <div class="spinner-border text-info" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <div class="spinner-border text-light" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <div class="spinner-border text-dark" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>

        </div>
        <!-- Main content -->
        {% block mainContent %}
        {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{message.tags}}">
            {{message}}
          </div>
        {% endfor %}
        {% endif %}
        {% endblock mainContent %}
          <!-- /.Left col -->
      </div>
        <!-- /.row (main row) -->
      </div><!-- /.container-fluid -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->
</div>

<!-- ./wrapper -->
<script>

  function addContacts(){

    $.post("{% url 'firstapp-addcontact' %}",{

      name: $("#cname").val(),
      phone: $("#cnum").val(),
      csrfmiddlewaretoken:'{{ csrf_token }}',
      },
      function(data,status){

          alert(data)
          location.reload()
      }


      )

  }

  $.get("{% url 'firstapp-getcontact' %}",function(data,status){

     var contacts = JSON.parse(data)
     for (var contact in contacts){
    $("#contacts").html(

        `
        <tr>
          <td>${contacts[contact]["pk"]}</td>
          <td>${contacts[contact]["fields"]["cont_name"]}</td>
          <td>${contacts[contact]["fields"]["cont_phone"]}</td>
          <td>${contacts[contact]["fields"]["cont_created"]}</td>
          </tr>

        `
    )
     }

  })

  function sendSms(){

    $.ajax({

         type:"POST",
         url:"{% url 'firstapp-sendsms' %}",
         data:{
          sms:$("#sms_text").val(),
          csrfmiddlewaretoken:'{{ csrf_token }}',
         },      
                    beforeSend:function(){

                        $("#plagSpinner").show()

                    },
                    complete:function(){
                        $("#plagSpinner").hide()
                    },
        success:function(data,status){

            alert(data)
        }
    }

)

  }


setInterval(onStatus,60000)
function onStatus(){
 if(navigator.onLine){



    $('.toast').toast('show');
    $(".toast-body").html("you are online")
  


 }else{

        $('.toast').toast('show');
     $("#toast-body").html("you are offline")
 }
}

  $(document).ready(function () {
    $('#sales').DataTable();
});

 


// mobile view setInterval

if(/Android|webOS|iPhone|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){
  // true for mobile device
        document.getElementById("mainCont").style.overflow = "scroll"
        document.getElementById("mainCont").style.width = "480px"
        document.getElementById("uphead").style.overflow = "scroll"
        document.getElementById("uphead").style.width = "480px"
        document.getElementById("cBtn").style.margin ="0px"
      }else{
  // false for not mobile device
        console.log("operating on pc")
      }

      document.querySelectorAll(".nav-link").forEach((link) => {
        if (link.href === window.location.href) {
            link.classList.add("active");
            link.setAttribute("aria-current", "page");
        }
    });

</script>
<script src="{% static 'firstapp/plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script> 
<script src="{% static 'firstapp/dist/js/adminlte.js' %}"></script>
</body>
</html>